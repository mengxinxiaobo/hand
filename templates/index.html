<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜çº§æ‰‹è¯­è¯†åˆ«ç³»ç»Ÿ</title>
    
    <!-- å¤–éƒ¨èµ„æº -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Tailwind CSS é…ç½® -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5', // ä¸»è‰²è°ƒ - é›è“è‰²
                        secondary: '#10B981', // è¾…åŠ©è‰² - ç»¿è‰²
                        accent: '#F59E0B', // å¼ºè°ƒè‰² - æ©™è‰²
                        dark: '#1E293B',
                        light: '#F8FAFC'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    boxShadow: {
                        'card': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                        'card-hover': '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
                    }
                },
            }
        }
    </script>
    
    <!-- è‡ªå®šä¹‰å·¥å…·ç±» -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            }
            .backdrop-blur {
                backdrop-filter: blur(8px);
            }
            .animate-fade-in {
                animation: fadeIn 0.5s ease-in-out;
            }
            .animate-slide-in {
                animation: slideIn 0.3s ease-out;
            }
            .scrollbar-hidden::-webkit-scrollbar {
                display: none;
            }
            .scrollbar-hidden {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
        }
    </style>
    
    <style>
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="font-inter bg-gradient-to-br from-slate-50 to-slate-100 min-h-screen text-dark">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="bg-white/80 backdrop-blur border-b border-slate-200 sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center">
                <i class="fa fa-hand-paper-o text-primary text-2xl"></i>
            </div>
            
            <nav class="hidden md:flex items-center space-x-6">
                <a href="#" class="font-medium text-primary hover:text-primary/80 transition-colors">é¦–é¡µ</a>
                <a href="#learn" class="font-medium text-slate-600 hover:text-primary transition-colors">å­¦ä¹ æ¨¡å¼</a>
                <a href="#about" class="font-medium text-slate-600 hover:text-primary transition-colors">å…³äº</a>
            </nav>
            
            <div class="flex items-center space-x-4">
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-slate-100 transition-colors">
                    <i class="fa fa-moon-o text-slate-600"></i>
                </button>
                <button class="md:hidden p-2 rounded-full hover:bg-slate-100 transition-colors">
                    <i class="fa fa-bars text-slate-600"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="container mx-auto px-4 py-8">

        <!-- çŠ¶æ€å¡ç‰‡ -->
        <div class="bg-white rounded-2xl shadow-card p-6 mb-8 animate-fade-in">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                <div>
                    <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-dark">å®æ—¶æ‰‹è¯­è¯†åˆ«</h2>
                    <p class="text-slate-500">å°†æ‚¨çš„æ‰‹æ”¾åœ¨æ‘„åƒå¤´å‰å¼€å§‹è¯†åˆ«</p>
                </div>
                
                <div class="mt-4 md:mt-0 flex items-center space-x-2 bg-slate-100 px-4 py-2 rounded-full">
                    <span class="inline-block w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                    <span class="text-sm font-medium">å®æ—¶æ¨¡å¼</span>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- è§†é¢‘åŒºåŸŸ -->
                <div class="lg:col-span-2 bg-dark rounded-xl overflow-hidden shadow-lg relative">
                    <div class="aspect-video bg-black/90 flex items-center justify-center">
                        <!-- åˆå§‹çŠ¶æ€æ˜¾ç¤ºå ä½ç¬¦ -->
                        <div id="video-placeholder" class="text-center text-white/70">
                            <i class="fa fa-video-camera text-6xl mb-4 block opacity-30"></i>
                            <h3 class="text-xl font-bold">æ‘„åƒå¤´æœªå¯åŠ¨</h3>
                            <p class="mt-2">è¯·ç‚¹å‡»æ§åˆ¶é¢æ¿ä¸­çš„ã€Œå¯åŠ¨è¯†åˆ«ã€æŒ‰é’®å¼€å§‹</p>
                        </div>
                        <!-- è§†é¢‘æµï¼Œåˆå§‹éšè— -->
                        <img id="video-frame" src="" alt="æ‘„åƒå¤´è§†é¢‘æµ" class="w-full h-full object-contain hidden">
                    </div>
                    
                    <!-- è§†é¢‘æ§åˆ¶è¦†ç›–å±‚ -->
                    <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4 hidden" id="video-controls">
                        <div class="flex justify-between items-center">
                            <div class="text-white">
                                <h3 class="text-xl font-bold" id="current-prediction">ç­‰å¾…è¯†åˆ«...</h3>
                                <p class="text-sm opacity-80" id="current-confidence">ç½®ä¿¡åº¦: 0%</p>
                            </div>
                            
                            <div class="flex items-center space-x-3">
                                <button id="toggle-landmarks" class="bg-white/20 hover:bg-white/30 text-white p-2 rounded-full transition-colors">
                                    <i class="fa fa-dot-circle-o"></i>
                                </button>
                                <button id="refresh-camera" class="bg-white/20 hover:bg-white/30 text-white p-2 rounded-full transition-colors">
                                    <i class="fa fa-refresh"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ§åˆ¶é¢æ¿ -->
                <div class="bg-white rounded-xl border border-slate-200 overflow-hidden shadow-card">
                    <div class="bg-primary p-4">
                        <h3 class="text-white font-bold text-lg">æ§åˆ¶é¢æ¿</h3>
                    </div>
                    
                    <div class="p-5 space-y-5">
                        <!-- æ¨¡å¼åˆ‡æ¢ -->
                        <div>
                            <h4 class="font-medium mb-2 text-slate-700">æ“ä½œæ¨¡å¼</h4>
                            <div class="flex flex-wrap gap-2">
                                <button id="mode-recognition" class="flex-1 py-2 px-3 rounded-lg bg-primary text-white font-medium transition-all">
                                    <i class="fa fa-eye mr-2"></i>è¯†åˆ«æ¨¡å¼
                                </button>
                                <button id="mode-learning" class="flex-1 py-2 px-3 rounded-lg bg-slate-200 text-slate-700 font-medium hover:bg-slate-300 transition-all">
                                    <i class="fa fa-book mr-2"></i>å­¦ä¹ æ¨¡å¼
                                </button>
                                <button id="mode-demo" class="flex-1 py-2 px-3 rounded-lg bg-slate-200 text-slate-700 font-medium hover:bg-slate-300 transition-all">
                                    <i class="fa fa-play-circle-o mr-2"></i>æ¼”ç¤ºæ¨¡å¼
                                </button>
                            </div>
                        </div>
                        
                        <!-- å¯åŠ¨æŒ‰é’® -->
                        <div class="pt-4">
                            <button id="start-recognition" class="w-full py-3 bg-secondary text-white font-bold rounded-lg hover:bg-secondary/90 transition-all shadow-lg shadow-secondary/20 flex items-center justify-center">
                                <i class="fa fa-play-circle text-xl mr-2"></i>
                                <span>å¯åŠ¨è¯†åˆ«</span>
                            </button>
                        </div>
                        
                        <!-- å‚æ•°æ§åˆ¶ -->
                        <div class="grid grid-cols-1 gap-4">
                            <!-- ç½®ä¿¡åº¦é˜ˆå€¼ -->
                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <h4 class="font-medium text-slate-700">ç½®ä¿¡åº¦é˜ˆå€¼</h4>
                                    <span id="threshold-value" class="text-sm font-medium text-primary">60%</span>
                                </div>
                                <input type="range" id="confidence-slider" min="0.1" max="1.0" step="0.05" value="0.6" 
                                       class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-primary">
                            </div>
                            
                            <!-- å¹³æ»‘çª—å£ -->
                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <h4 class="font-medium text-slate-700">å¹³æ»‘çª—å£</h4>
                                    <span id="smooth-window-value" class="text-sm font-medium text-primary">3</span>
                                </div>
                                <input type="range" id="smooth-slider" min="1" max="10" step="1" value="3" 
                                       class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-primary">
                            </div>
                        </div>
                        
                        <!-- é€‰é¡¹è®¾ç½® -->
                        <div class="space-y-3">
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="is-recording" class="rounded text-primary focus:ring-primary/50 border-slate-300">
                                <span class="text-slate-700">è®°å½•è¯†åˆ«ç»“æœ</span>
                            </label>
                            
                            <div class="relative pt-1">
                                <div class="flex items-center justify-between">
                                    <h4 class="font-medium text-slate-700">è¯†åˆ«è¯­è¨€</h4>
                                </div>
                                <select class="w-full p-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary mt-2">
                                    <option>ä¸­å›½æ‰‹è¯­å­—æ¯</option>
                                    <option>ç¾å›½æ‰‹è¯­å­—æ¯</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- åŠ¨ä½œæŒ‰é’® -->
                        <div class="pt-3 grid grid-cols-2 gap-3">
                            <button id="clear-history" class="py-3 bg-red-50 text-red-600 font-medium rounded-lg hover:bg-red-100 transition-colors">
                                <i class="fa fa-trash mr-2"></i>æ¸…é™¤å†å²
                            </button>
                            <button id="reset-statistics" class="py-3 bg-orange-50 text-orange-600 font-medium rounded-lg hover:bg-orange-100 transition-colors">
                                <i class="fa fa-refresh mr-2"></i>é‡ç½®ç»Ÿè®¡
                            </button>
                            <button id="export-data" class="col-span-2 py-3 bg-green-50 text-green-600 font-medium rounded-lg hover:bg-green-100 transition-colors">
                                <i class="fa fa-download mr-2"></i>å¯¼å‡ºæ•°æ®
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- å†å²è®°å½•å’Œç»Ÿè®¡åŒºåŸŸ -->
        <div class="bg-white rounded-2xl shadow-card p-6 mb-8 animate-slide-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-dark">è¯†åˆ«å†å²ä¸ç»Ÿè®¡</h2>
                <span id="history-count" class="bg-slate-100 text-slate-700 px-3 py-1 rounded-full text-sm">0 æ¡è®°å½•</span>
            </div>
            
            <!-- ç»Ÿè®¡ä¿¡æ¯å¡ç‰‡ -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-slate-50 rounded-xl p-4 border border-slate-100">
                    <p class="text-sm text-slate-500 mb-1">æ€»è¯†åˆ«æ¬¡æ•°</p>
                    <p id="total-predictions" class="text-2xl font-bold text-primary">0</p>
                </div>
                <div class="bg-slate-50 rounded-xl p-4 border border-slate-100">
                    <p class="text-sm text-slate-500 mb-1">å½“å‰FPS</p>
                    <p id="current-fps" class="text-2xl font-bold text-primary">0</p>
                </div>
                <div class="bg-slate-50 rounded-xl p-4 border border-slate-100">
                    <p class="text-sm text-slate-500 mb-1">æœ€å¸¸è§æ‰‹åŠ¿</p>
                    <p id="most-common-gesture" class="text-2xl font-bold text-primary">-</p>
                </div>
                <div class="bg-slate-50 rounded-xl p-4 border border-slate-100">
                    <p class="text-sm text-slate-500 mb-1">æ‰‹éƒ¨çŠ¶æ€</p>
                    <p id="hand-status" class="text-2xl font-bold text-red-500">æœªæ£€æµ‹</p>
                </div>
            </div>
            
            <!-- æ‰‹åŠ¿åˆ†å¸ƒå›¾è¡¨ -->
            <div class="bg-slate-50 rounded-xl p-4 border border-slate-100 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-slate-700">æ‰‹åŠ¿åˆ†å¸ƒ</h3>
                <div class="h-64">
                    <canvas id="gesture-chart"></canvas>
                </div>
            </div>
            
            <!-- å†å²è®°å½•è¡¨æ ¼ -->
            <h3 class="text-lg font-semibold mb-4 text-slate-700">æœ€è¿‘è¯†åˆ«è®°å½•</h3>
            <div class="overflow-x-auto">
                <table class="min-w-full">
                    <thead>
                        <tr class="bg-slate-50 border-b border-slate-200">
                            <th class="py-3 px-4 text-left text-sm font-medium text-slate-500">åºå·</th>
                            <th class="py-3 px-4 text-left text-sm font-medium text-slate-500">è¯†åˆ«ç»“æœ</th>
                            <th class="py-3 px-4 text-left text-sm font-medium text-slate-500">ç½®ä¿¡åº¦</th>
                            <th class="py-3 px-4 text-left text-sm font-medium text-slate-500">æ—¶é—´</th>
                        </tr>
                    </thead>
                    <tbody id="history-table-body">
                        <tr>
                            <td colspan="4" class="py-8 text-center text-slate-500">
                                <i class="fa fa-history text-3xl mb-2 block opacity-30"></i>
                                æš‚æ— è¯†åˆ«å†å²
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- å­¦ä¹ æ¨¡å¼åŒºåŸŸ -->
        <div id="learn" class="bg-white rounded-2xl shadow-card p-6 mb-8 animate-slide-in">
            <h2 class="text-xl font-bold text-dark mb-6">æ‰‹åŠ¿å­¦ä¹ ä¸­å¿ƒ</h2>
            
            <!-- æ¨¡å¼åˆ‡æ¢æŒ‰é’® -->
            <div class="flex gap-2 mb-6" id="learn-mode-buttons">
                <button id="btn-identify-mode" class="mode-btn px-4 py-2 rounded-lg border transition-colors">
                    è¯†åˆ«æ¨¡å¼
                </button>
                <button id="btn-learn-mode" class="mode-btn px-4 py-2 rounded-lg border bg-primary text-white transition-colors">
                    å­¦ä¹ æ¨¡å¼
                </button>
                <button id="btn-demo-mode" class="mode-btn px-4 py-2 rounded-lg border transition-colors">
                    æ¼”ç¤ºæ¨¡å¼
                </button>
            </div>
            
            <!-- æœç´¢å’Œç­›é€‰ -->
            <div class="mb-6 flex flex-col sm:flex-row gap-4">
                <div class="flex-grow relative">
                    <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                    <input type="text" id="gesture-search" placeholder="æœç´¢æ‰‹åŠ¿..." 
                           class="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                </div>
                <div>
                    <select id="gesture-category" class="w-full sm:w-40 p-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                        <option value="all">æ‰€æœ‰ç±»åˆ«</option>
                        <option value="letters">å­—æ¯</option>
                        <option value="numbers">æ•°å­—</option>
                    </select>
                </div>
            </div>
            
            <!-- æ‰‹åŠ¿æŒ‡å— -->
            <div id="gesture-guide" class="mb-6 p-5 bg-primary/5 rounded-xl border border-primary/20 hidden">
                <h3 class="text-xl font-bold mb-4" id="guide-title">æ‰‹åŠ¿æŒ‡å—</h3>
                <div class="flex flex-col md:flex-row gap-6">
                    <div class="md:w-1/3">
                        <div id="guide-image" class="aspect-square bg-slate-100 rounded-lg flex items-center justify-center">
                            <span id="guide-letter" class="text-6xl font-bold text-primary">A</span>
                        </div>
                    </div>
                    <div class="md:w-2/3">
                        <h4 class="font-semibold text-slate-700 mb-2">å¦‚ä½•æ“ä½œ:</h4>
                        <p id="guide-description" class="text-slate-600 mb-4">æ‰‹åŠ¿æè¿°å°†æ˜¾ç¤ºåœ¨è¿™é‡Œã€‚</p>
                        <h4 class="font-semibold text-slate-700 mb-2">å°è´´å£«:</h4>
                        <ul id="guide-tips" class="text-slate-600 space-y-1 list-disc list-inside">
                            <li>ç¡®ä¿æ‰‹éƒ¨åœ¨æ‘„åƒå¤´å¯è§èŒƒå›´å†…</li>
                            <li>ä¿æŒæ‰‹éƒ¨ç¨³å®š</li>
                            <li>å…‰çº¿å……è¶³æœ‰åŠ©äºæé«˜è¯†åˆ«å‡†ç¡®ç‡</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- æ‰‹åŠ¿å¡ç‰‡ç½‘æ ¼ -->
            <div id="gesture-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 lg:grid-cols-10 gap-3">
                {% for gesture in gestures %}
                <button class="gesture-card aspect-square rounded-xl border border-slate-200 flex flex-col items-center justify-center p-3 hover:border-primary hover:shadow-md transition-all">
                    <span class="text-2xl font-bold text-primary mb-1">{{ gesture }}</span>
                    <span class="text-xs text-slate-500">{{ gesture }}</span>
                </button>
                {% endfor %}
            </div>
        </div>
    </main>
    
    <!-- é¡µè„š -->
    <footer class="bg-dark text-white py-10">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <div class="flex items-center space-x-2 mb-4">
                        <i class="fa fa-hand-paper-o text-primary text-2xl"></i>
                        <h2 class="text-xl font-bold">é«˜çº§æ‰‹è¯­è¯†åˆ«ç³»ç»Ÿ</h2>
                    </div>
                    <p class="text-slate-400">
                        æœ¬ç³»ç»Ÿä½¿ç”¨å…ˆè¿›çš„è®¡ç®—æœºè§†è§‰å’Œæœºå™¨å­¦ä¹ æŠ€æœ¯ï¼Œå®ç°å®æ—¶æ‰‹è¯­è¯†åˆ«ï¼Œ
                        å¸®åŠ©å¬éšœäººå£«ä¸å¥å¬äººå£«ä¹‹é—´çš„æ²Ÿé€šäº¤æµã€‚
                    </p>
                </div>
                
                <div>
                    <h3 class="font-bold text-lg mb-4">å¿«é€Ÿé“¾æ¥</h3>
                    <ul class="space-y-2 text-slate-400">
                        <li><a href="#" class="hover:text-primary transition-colors">é¦–é¡µ</a></li>
                        <li><a href="#learn" class="hover:text-primary transition-colors">å­¦ä¹ æ¨¡å¼</a></li>
                        <li><a href="#" class="hover:text-primary transition-colors">æ‰‹åŠ¿æŒ‡å—</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="font-bold text-lg mb-4">å…³äº</h3>
                    <ul class="space-y-2 text-slate-400">
                        <li><a href="#about" class="hover:text-primary transition-colors">å…³äºæˆ‘ä»¬</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="font-bold text-lg mb-4">è”ç³»æˆ‘ä»¬</h3>
                    <ul class="space-y-3 text-slate-400">
                        <li class="flex items-start">
                            <i class="fa fa-envelope-o mt-1 mr-3 text-primary"></i>
                            <span>æ²ˆé˜³å·¥ä¸šå¤§å­¦</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fa fa-github mt-1 mr-3 text-primary"></i>
                            <span>è®¡ç®—æœºæŠ€æœ¯</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-slate-800 mt-8 pt-8 text-center text-slate-500 text-sm">
                <p>&copy; {{ current_year }} é«˜çº§æ‰‹è¯­è¯†åˆ«ç³»ç»Ÿ. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
            </div>
        </div>
    </footer>
    
    <!-- JavaScript -->
    <script>
        // åˆå§‹åŒ–å˜é‡
        let predictionHistory = [];
        let showLandmarks = true;
        let currentMode = 'recognition';
        let confidenceThreshold = 0.6;
        let smoothWindow = 3;
        let isRecording = false;
        let isRunning = false; // æ–°å¢ï¼šè·Ÿè¸ªè¯†åˆ«æ˜¯å¦æ­£åœ¨è¿è¡Œ
        let gestureChart = null;
        
        // åˆå§‹åŒ–æ‰‹åŠ¿åˆ†å¸ƒå›¾è¡¨
        function initGestureChart() {
            const ctx = document.getElementById('gesture-chart').getContext('2d');
            gestureChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'è¯†åˆ«æ¬¡æ•°',
                        data: [],
                        backgroundColor: 'rgba(79, 70, 229, 0.6)',
                        borderColor: 'rgba(79, 70, 229, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });
        }
        
        // æ›´æ–°ç³»ç»ŸçŠ¶æ€çš„å‡½æ•°
async function updateSystemState() {
            try {
                const response = await fetch('/api/state');
                const data = await response.json();

                // ğŸŸ¢ æ ¸å¿ƒä¿®æ”¹ï¼šç›´æ¥è¯»å–æ»‘å—å½“å‰çš„å®æ—¶æ•°å€¼ï¼Œè°éƒ½åˆ«æƒ³è¦†ç›–å®ƒï¼
                const sliderValue = parseFloat(document.getElementById('confidence-slider').value);

                // æ›´æ–°UIæ˜¾ç¤º
                // åªæœ‰å½“ï¼šæœ‰é¢„æµ‹ç»“æœ ä¸” åç«¯ä¼ æ¥çš„ç½®ä¿¡åº¦ >= æ»‘å—å½“å‰çš„å€¼
                if (data.last_prediction && data.last_confidence >= sliderValue) {

                    document.getElementById('current-prediction').textContent = `è¯†åˆ«ç»“æœ: ${data.last_prediction}`;
                    // æ˜¾ç¤ºç™¾åˆ†æ¯”
                    document.getElementById('current-confidence').textContent = `ç½®ä¿¡åº¦: ${(data.last_confidence * 100).toFixed(0)}%`;

                    // é¢œè‰²é€»è¾‘...

                } else {
                    // ğŸ”´ åªè¦ä½äºæ»‘å—å€¼ï¼Œä¸€å¾‹æ˜¾ç¤ºâ€œç­‰å¾…â€
                    document.getElementById('current-prediction').textContent = 'ç­‰å¾…è¯†åˆ«...';

                    // å³ä½¿å¤„äºç­‰å¾…çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥æ˜¾ç¤ºå½“å‰çš„å®æ—¶ç½®ä¿¡åº¦ï¼ˆæ–¹ä¾¿ä½ è°ƒè¯•ï¼‰ï¼Œæˆ–è€…æ˜¾ç¤º0%
                    // å¦‚æœä½ æƒ³çœ‹å®ƒæ˜¯æ€ä¹ˆâ€œå¤±è´¥â€çš„ï¼Œå¯ä»¥ç”¨ä¸‹é¢è¿™è¡Œï¼š
                    // document.getElementById('current-confidence').textContent = `å½“å‰: ${(data.last_confidence * 100).toFixed(0)}% (æœªè¾¾æ ‡)`;

                    // å¦‚æœä½ æƒ³è®©ç•Œé¢å¹²å‡€ç‚¹ï¼Œå°±ç”¨è¿™è¡Œï¼š
                    document.getElementById('current-confidence').textContent = 'ç½®ä¿¡åº¦ä¸è¶³';
                }

                // ... åé¢çš„æ›´æ–°å†å²è®°å½•ã€å›¾è¡¨ç­‰ä»£ç ä¿æŒä¸å˜ ...


                // æ›´æ–°å†å²è®°å½•ï¼ˆå¦‚æœæœ‰æ–°çš„é¢„æµ‹ï¼‰
                if (data.prediction_history && data.prediction_history.length > predictionHistory.length) {
                    predictionHistory = data.prediction_history;
                    updateHistoryTable();
                }

                // æ›´æ–°æ¨¡å¼çŠ¶æ€
                if (data.mode !== currentMode) {
                    currentMode = data.mode;
                    updateModeButtons();
                }

                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                document.getElementById('total-predictions').textContent = data.total_predictions || 0;
                document.getElementById('current-fps').textContent = data.performance_metrics?.frame_rate || 0;

                // æ›´æ–°æ‰‹éƒ¨çŠ¶æ€
                const handStatus = document.getElementById('hand-status');
                if (data.hand_detected) {
                    handStatus.textContent = 'å·²æ£€æµ‹';
                    handStatus.className = 'text-2xl font-bold text-green-500';
                } else {
                    handStatus.textContent = 'æœªæ£€æµ‹';
                    handStatus.className = 'text-2xl font-bold text-red-500';
                }

                // æ›´æ–°æ‰‹åŠ¿ç»Ÿè®¡å›¾è¡¨
                if (data.gesture_statistics && gestureChart) {
                    const gestures = Object.keys(data.gesture_statistics);
                    const counts = Object.values(data.gesture_statistics);

                    // æ‰¾å‡ºæœ€å¸¸è§çš„æ‰‹åŠ¿
                    if (gestures.length > 0) {
                        let maxCount = 0;
                        let mostCommon = '-';
                        for (const [gesture, count] of Object.entries(data.gesture_statistics)) {
                            if (count > maxCount) {
                                maxCount = count;
                                mostCommon = gesture;
                            }
                        }
                        document.getElementById('most-common-gesture').textContent = mostCommon;
                    }

                    // æ›´æ–°å›¾è¡¨æ•°æ®
                    gestureChart.data.labels = gestures;
                    gestureChart.data.datasets[0].data = counts;
                    gestureChart.update();
                }

                // æ›´æ–°çŠ¶æ€å˜é‡
                // showLandmarks = data.show_landmarks;
                // confidenceThreshold = data.confidence_threshold;

            } catch (error) {
                console.error('è·å–çŠ¶æ€å¤±è´¥:', error);
            }
        }
        
        // æ›´æ–°å†å²è®°å½•è¡¨
        function updateHistoryTable() {
            const tableBody = document.getElementById('history-table-body');
            const historyCount = document.getElementById('history-count');
            
            if (predictionHistory.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="4" class="py-8 text-center text-slate-500">
                            <i class="fa fa-history text-3xl mb-2 block opacity-30"></i>
                            æš‚æ— è¯†åˆ«å†å²
                        </td>
                    </tr>
                `;
                historyCount.textContent = '0 æ¡è®°å½•';
                return;
            }
            
            historyCount.textContent = `${predictionHistory.length} æ¡è®°å½•`;
            
            let rows = '';
            predictionHistory.slice(-10).forEach((item, index) => {
                const timestamp = new Date().toLocaleTimeString();
                const confidenceClass = item[1] > 0.7 ? 'text-green-600' : item[1] > 0.5 ? 'text-orange-600' : 'text-red-600';
                
                rows += `
                    <tr class="border-b border-slate-100 hover:bg-slate-50 transition-colors">
                        <td class="py-3 px-4 text-sm text-slate-500">${index + 1}</td>
                        <td class="py-3 px-4 font-medium">${item[0]}</td>
                        <td class="py-3 px-4 text-sm ${confidenceClass}">${(item[1] * 100).toFixed(0)}%</td>
                        <td class="py-3 px-4 text-sm text-slate-500">${timestamp}</td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = rows;
        }
        
        // æ›´æ–°æ¨¡å¼æŒ‰é’®çŠ¶æ€å¹¶åˆ‡æ¢UIæ˜¾ç¤º
        function updateModeButtons() {
            const recognitionBtn = document.getElementById('mode-recognition');
            const learningBtn = document.getElementById('mode-learning');
            const demoBtn = document.getElementById('mode-demo');
            
            // è·å–å­¦ä¹ æ¨¡å¼åŒºåŸŸçš„æŒ‰é’®
            const learnRecognitionBtn = document.getElementById('learn-mode-buttons')?.querySelector('#btn-identify-mode');
            const learnLearningBtn = document.getElementById('learn-mode-buttons')?.querySelector('#btn-learn-mode');
            const learnDemoBtn = document.getElementById('learn-mode-buttons')?.querySelector('#btn-demo-mode');
            
            // è·å–æ¼”ç¤ºæ¨¡å¼åŒºåŸŸçš„æŒ‰é’®
            const demoRecognitionBtn = document.getElementById('demo-mode-buttons')?.querySelector('#demo-btn-identify-mode');
            const demoLearningBtn = document.getElementById('demo-mode-buttons')?.querySelector('#demo-btn-learn-mode');
            const demoDemoBtn = document.getElementById('demo-mode-buttons')?.querySelector('#demo-btn-demo-mode');
            
            // é‡ç½®ä¸»æ§åˆ¶é¢æ¿çš„æŒ‰é’®
            [recognitionBtn, learningBtn, demoBtn].forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('bg-slate-200', 'text-slate-700');
            });
            
            // é‡ç½®å­¦ä¹ æ¨¡å¼åŒºåŸŸçš„æŒ‰é’®
            [learnRecognitionBtn, learnLearningBtn, learnDemoBtn].forEach(btn => {
                if (btn) {
                    btn.classList.remove('bg-primary', 'text-white');
                    btn.classList.add('border-slate-300');
                }
            });
            
            // é‡ç½®æ¼”ç¤ºæ¨¡å¼åŒºåŸŸçš„æŒ‰é’®
            [demoRecognitionBtn, demoLearningBtn, demoDemoBtn].forEach(btn => {
                if (btn) {
                    btn.classList.remove('bg-primary', 'text-white');
                    btn.classList.add('border-slate-300');
                }
            });
            
            // æ¿€æ´»å½“å‰æ¨¡å¼æŒ‰é’®å¹¶åˆ‡æ¢UIæ˜¾ç¤º
            if (currentMode === 'recognition') {
                recognitionBtn.classList.remove('bg-slate-200', 'text-slate-700');
                recognitionBtn.classList.add('bg-primary', 'text-white');
                
                // æ›´æ–°å­¦ä¹ æ¨¡å¼åŒºåŸŸçš„è¯†åˆ«æ¨¡å¼æŒ‰é’®
                if (learnRecognitionBtn) {
                    learnRecognitionBtn.classList.remove('border-slate-300');
                    learnRecognitionBtn.classList.add('bg-primary', 'text-white');
                }
                
                // æ›´æ–°æ¼”ç¤ºæ¨¡å¼åŒºåŸŸçš„è¯†åˆ«æ¨¡å¼æŒ‰é’®
                if (demoRecognitionBtn) {
                    demoRecognitionBtn.classList.remove('border-slate-300');
                    demoRecognitionBtn.classList.add('bg-primary', 'text-white');
                }
                
                // æ˜¾ç¤ºè¯†åˆ«æ¨¡å¼ç›¸å…³UI
                document.querySelector('.bg-white.rounded-2xl.shadow-card.p-6.mb-8.animate-fade-in').classList.remove('hidden'); // çŠ¶æ€å¡ç‰‡
                document.querySelector('.bg-white.rounded-2xl.shadow-card.p-6.mb-8.animate-slide-in').classList.remove('hidden'); // å†å²è®°å½•å’Œç»Ÿè®¡
                document.getElementById('learn').classList.add('hidden'); // éšè—å­¦ä¹ æ¨¡å¼
                
                // å¦‚æœå­˜åœ¨æ¼”ç¤ºæ¨¡å¼åŒºåŸŸï¼Œéšè—å®ƒ
                const demoSection = document.getElementById('demo');
                if (demoSection) demoSection.classList.add('hidden');
                
            } else if (currentMode === 'learning') {
                learningBtn.classList.remove('bg-slate-200', 'text-slate-700');
                learningBtn.classList.add('bg-primary', 'text-white');
                
                // æ›´æ–°å­¦ä¹ æ¨¡å¼åŒºåŸŸçš„å­¦ä¹ æ¨¡å¼æŒ‰é’®
                if (learnLearningBtn) {
                    learnLearningBtn.classList.remove('border-slate-300');
                    learnLearningBtn.classList.add('bg-primary', 'text-white');
                }
                
                // æ›´æ–°æ¼”ç¤ºæ¨¡å¼åŒºåŸŸçš„å­¦ä¹ æ¨¡å¼æŒ‰é’®
                if (demoLearningBtn) {
                    demoLearningBtn.classList.remove('border-slate-300');
                    demoLearningBtn.classList.add('bg-primary', 'text-white');
                }
                
                // éšè—è¯†åˆ«æ¨¡å¼ç›¸å…³UIï¼Œæ˜¾ç¤ºå­¦ä¹ æ¨¡å¼
                document.querySelector('.bg-white.rounded-2xl.shadow-card.p-6.mb-8.animate-fade-in').classList.add('hidden'); // çŠ¶æ€å¡ç‰‡
                document.querySelector('.bg-white.rounded-2xl.shadow-card.p-6.mb-8.animate-slide-in').classList.add('hidden'); // å†å²è®°å½•å’Œç»Ÿè®¡
                document.getElementById('learn').classList.remove('hidden'); // æ˜¾ç¤ºå­¦ä¹ æ¨¡å¼
                
                // å¦‚æœå­˜åœ¨æ¼”ç¤ºæ¨¡å¼åŒºåŸŸï¼Œéšè—å®ƒ
                const demoSection = document.getElementById('demo');
                if (demoSection) demoSection.classList.add('hidden');
                
            } else if (currentMode === 'demo') {
                demoBtn.classList.remove('bg-slate-200', 'text-slate-700');
                demoBtn.classList.add('bg-primary', 'text-white');
                
                // æ›´æ–°å­¦ä¹ æ¨¡å¼åŒºåŸŸçš„æ¼”ç¤ºæ¨¡å¼æŒ‰é’®
                if (learnDemoBtn) {
                    learnDemoBtn.classList.remove('border-slate-300');
                    learnDemoBtn.classList.add('bg-primary', 'text-white');
                }
                
                // æ›´æ–°æ¼”ç¤ºæ¨¡å¼åŒºåŸŸçš„æ¼”ç¤ºæ¨¡å¼æŒ‰é’®
                if (demoDemoBtn) {
                    demoDemoBtn.classList.remove('border-slate-300');
                    demoDemoBtn.classList.add('bg-primary', 'text-white');
                }
                
                // éšè—è¯†åˆ«æ¨¡å¼ç›¸å…³UIï¼Œæ£€æŸ¥å¹¶æ˜¾ç¤ºæ¼”ç¤ºæ¨¡å¼
                document.querySelector('.bg-white.rounded-2xl.shadow-card.p-6.mb-8.animate-fade-in').classList.add('hidden'); // çŠ¶æ€å¡ç‰‡
                document.querySelector('.bg-white.rounded-2xl.shadow-card.p-6.mb-8.animate-slide-in').classList.add('hidden'); // å†å²è®°å½•å’Œç»Ÿè®¡
                document.getElementById('learn').classList.add('hidden'); // éšè—å­¦ä¹ æ¨¡å¼
                
                // å¦‚æœæ¼”ç¤ºæ¨¡å¼åŒºåŸŸä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªç®€å•çš„æ¼”ç¤ºæ¨¡å¼ç•Œé¢
                let demoSection = document.getElementById('demo');
                if (!demoSection) {
                    demoSection = document.createElement('div');
                    demoSection.id = 'demo';
                    demoSection.className = 'bg-white rounded-2xl shadow-card p-6 mb-8 animate-slide-in';
                    demoSection.innerHTML = `
                        <h2 class="text-xl font-bold text-dark mb-6">æ¼”ç¤ºæ¨¡å¼</h2>
                        
                        <!-- æ¨¡å¼åˆ‡æ¢æŒ‰é’® -->
                        <div class="flex gap-2 mb-6" id="demo-mode-buttons">
                            <button id="demo-btn-identify-mode" class="mode-btn px-4 py-2 rounded-lg border transition-colors">
                                è¯†åˆ«æ¨¡å¼
                            </button>
                            <button id="demo-btn-learn-mode" class="mode-btn px-4 py-2 rounded-lg border transition-colors">
                                å­¦ä¹ æ¨¡å¼
                            </button>
                            <button id="demo-btn-demo-mode" class="mode-btn px-4 py-2 rounded-lg border bg-primary text-white transition-colors">
                                æ¼”ç¤ºæ¨¡å¼
                            </button>
                        </div>
                        <div class="bg-slate-50 p-6 rounded-xl text-center">
                            <i class="fa fa-play-circle text-6xl text-primary mb-4"></i>
                            <h3 class="text-xl font-bold mb-2">æ‰‹è¯­æ¼”ç¤º</h3>
                            <p class="text-slate-600 mb-6">è§‚çœ‹å¸¸è§æ‰‹è¯­æ‰‹åŠ¿çš„æ¼”ç¤º</p>
                            <div class="grid grid-cols-3 md:grid-cols-5 gap-4">
                                ${['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'].map(gesture => `
                                    <button class="demo-gesture-btn bg-white border border-slate-200 rounded-lg p-4 hover:border-primary transition-all">
                                        <span class="text-3xl font-bold text-primary">${gesture}</span>
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    document.querySelector('main').appendChild(demoSection);
                } else {
                    demoSection.classList.remove('hidden');
                }
                
                // æ·»åŠ æ¼”ç¤ºæ‰‹åŠ¿æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶
                document.querySelectorAll('.demo-gesture-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const gesture = this.querySelector('span').textContent;
                        showGestureGuide(gesture);
                    });
                });
                
                // ä¸ºæ¼”ç¤ºæ¨¡å¼åŒºåŸŸçš„æ¨¡å¼åˆ‡æ¢æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                if (document.getElementById('demo-mode-buttons')) {
                    document.getElementById('demo-mode-buttons').querySelector('#demo-btn-identify-mode').addEventListener('click', function() {
                        sendSettingsUpdate({ mode: 'recognition' });
                    });
                    
                    document.getElementById('demo-mode-buttons').querySelector('#demo-btn-learn-mode').addEventListener('click', function() {
                        sendSettingsUpdate({ mode: 'learning' });
                    });
                    
                    document.getElementById('demo-mode-buttons').querySelector('#demo-btn-demo-mode').addEventListener('click', function() {
                        sendSettingsUpdate({ mode: 'demo' });
                    });
                }
            }
        }
        
        // å‘é€è®¾ç½®æ›´æ–°
        async function sendSettingsUpdate(settings) {
            try {
                const response = await fetch('/api/settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(settings)
                });
                
                if (!response.ok) {
                    throw new Error('æ›´æ–°è®¾ç½®å¤±è´¥');
                }
                
                await response.json();
                
                // æ›´æ–°å®¢æˆ·ç«¯çš„currentModeå˜é‡ï¼ˆå¦‚æœè®¾ç½®äº†modeï¼‰
                if (settings.mode) {
                    currentMode = settings.mode;
                    // ç¡®ä¿æ‰€æœ‰åŒºåŸŸçš„æŒ‰é’®çŠ¶æ€æ­£ç¡®æ›´æ–°
                    updateModeButtons();
                }
            } catch (error) {
                console.error('å‘é€è®¾ç½®æ›´æ–°å¤±è´¥:', error);
            }
        }
        
        // é‡ç½®ç»Ÿè®¡ä¿¡æ¯
        async function resetStatistics() {
            try {
                const response = await fetch('/api/reset_statistics', {
                    method: 'POST'
                });
                
                if (!response.ok) {
                    throw new Error('é‡ç½®ç»Ÿè®¡å¤±è´¥');
                }
                
                await response.json();
                // é‡ç½®å›¾è¡¨
                if (gestureChart) {
                    gestureChart.data.labels = [];
                    gestureChart.data.datasets[0].data = [];
                    gestureChart.update();
                }
                document.getElementById('total-predictions').textContent = '0';
                document.getElementById('most-common-gesture').textContent = '-';
            } catch (error) {
                console.error('é‡ç½®ç»Ÿè®¡å¤±è´¥:', error);
            }
        }
        
        // å¯¼å‡ºæ•°æ®
        async function exportData() {
            try {
                const response = await fetch('/api/state');
                const data = await response.json();
                
                const exportData = {
                    timestamp: new Date().toISOString(),
                    prediction_history: data.prediction_history,
                    gesture_statistics: data.gesture_statistics,
                    performance_metrics: data.performance_metrics,
                    total_predictions: data.total_predictions
                };
                
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `sign_language_data_${Date.now()}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } catch (error) {
                console.error('å¯¼å‡ºæ•°æ®å¤±è´¥:', error);
            }
        }
        
        // æ˜¾ç¤ºæ‰‹åŠ¿æŒ‡å—
        function showGestureGuide(gesture) {
            const guide = document.getElementById('gesture-guide');
            const guideTitle = document.getElementById('guide-title');
            const guideLetter = document.getElementById('guide-letter');
            const guideDescription = document.getElementById('guide-description');

            guideTitle.textContent = `æ‰‹åŠ¿ ${gesture} æŒ‡å—`;
            guideLetter.textContent = gesture;

            // ä¸ºä¸åŒçš„æ‰‹åŠ¿æä¾›ä¸åŒçš„æè¿°
            const descriptions = {
                'A': 'å°†æ‰‹æŒå¼ å¼€ï¼Œæ‹‡æŒ‡å’Œé£ŸæŒ‡å½¢æˆä¸€ä¸ªåœ†åœˆï¼Œå…¶ä»–æ‰‹æŒ‡ä¼¸ç›´ã€‚',
                'B': 'å°†æ‰‹æŒå±•å¼€ï¼Œæ‰€æœ‰æ‰‹æŒ‡ä¼¸ç›´å¹¶å¹¶æ‹¢ã€‚',
                'C': 'å°†æ‰‹æŒå¼¯æ›²æˆä¸€ä¸ªCå½¢çŠ¶ï¼Œæ‹‡æŒ‡å’Œå…¶ä»–æ‰‹æŒ‡å½¢æˆä¸€ä¸ªåŠåœ†ã€‚',
                'D': 'å°†æ‰‹æŒä¼¸ç›´ï¼Œé£ŸæŒ‡æŒ‡å‘ä¸Šæ–¹ï¼Œå…¶ä»–æ‰‹æŒ‡å¼¯æ›²å¹¶è´´åœ¨æ‰‹æŒä¸Šã€‚',
                'E': 'å°†æ‰€æœ‰æ‰‹æŒ‡å¼¯æ›²ï¼ŒæŒ‡å°–è§¦ç¢°æ‹‡æŒ‡ï¼Œå½¢æˆä¸€ä¸ªæ‹³å¤´ä½†ä¸å®Œå…¨æ¡ç´§ã€‚',
                'F': 'å°†æ‹‡æŒ‡å’Œé£ŸæŒ‡å½¢æˆä¸€ä¸ªFå½¢çŠ¶ï¼Œå…¶ä»–æ‰‹æŒ‡ä¼¸ç›´ã€‚',
                'G': 'å°†æ‰‹æŒä¼¸ç›´ï¼Œæ‹‡æŒ‡å’Œé£ŸæŒ‡å½¢æˆä¸€ä¸ªGå½¢çŠ¶ï¼Œå…¶ä»–æ‰‹æŒ‡ä¼¸ç›´ã€‚',
                'H': 'å°†æ‰‹æŒä¼¸ç›´ï¼Œé£ŸæŒ‡å’Œä¸­æŒ‡ä¼¸ç›´å¹¶åˆ†å¼€ï¼Œå…¶ä»–æ‰‹æŒ‡å¼¯æ›²ã€‚',
                'I': 'å°†æ‰‹æŒä¼¸ç›´ï¼Œåªæœ‰é£ŸæŒ‡ä¼¸ç›´ï¼Œå…¶ä»–æ‰‹æŒ‡å¼¯æ›²è´´åœ¨æ‰‹æŒä¸Šã€‚',
                'J': 'å…ˆåšIçš„æ‰‹åŠ¿ï¼Œç„¶åå‘ä¸‹ç”»ä¸€ä¸ªJå½¢çŠ¶ã€‚',
                'K': 'å°†æ‰‹æŒä¼¸ç›´ï¼Œé£ŸæŒ‡å’Œä¸­æŒ‡ä¼¸ç›´å¹¶åˆ†å¼€ï¼Œæ‹‡æŒ‡æŒ‡å‘å¤–ä¾§ã€‚',
                'L': 'å°†æ‹‡æŒ‡å’Œé£ŸæŒ‡å½¢æˆä¸€ä¸ªLå½¢çŠ¶ï¼Œå…¶ä»–æ‰‹æŒ‡å¼¯æ›²ã€‚',
                'M': 'å°†æ‹‡æŒ‡è´´åœ¨æ‰‹æŒä¸Šï¼Œå…¶ä»–ä¸‰ä¸ªæ‰‹æŒ‡å¼¯æ›²å¹¶å¹¶æ‹¢ï¼Œå½¢æˆMå½¢çŠ¶ã€‚',
                'N': 'å°†æ‹‡æŒ‡è´´åœ¨æ‰‹æŒä¸Šï¼Œä¸­æŒ‡å’Œæ— åæŒ‡å¼¯æ›²å¹¶å¹¶æ‹¢ï¼Œå½¢æˆNå½¢çŠ¶ã€‚',
                'O': 'å°†æ‰€æœ‰æ‰‹æŒ‡å¼¯æ›²ï¼ŒæŒ‡å°–ç›¸äº’è§¦ç¢°ï¼Œå½¢æˆä¸€ä¸ªåœ†å½¢ã€‚',
                'P': 'å°†æ‰‹æŒä¼¸ç›´ï¼Œæ‹‡æŒ‡å’Œé£ŸæŒ‡å½¢æˆä¸€ä¸ªPå½¢çŠ¶ï¼Œå…¶ä»–æ‰‹æŒ‡ä¼¸ç›´ã€‚',
                'Q': 'å°†æ‰€æœ‰æ‰‹æŒ‡å¼¯æ›²ï¼Œç„¶åæ‹‡æŒ‡å‘ä¸‹æŒ‡ã€‚',
                'R': 'å°†æ‰‹æŒä¼¸ç›´ï¼Œé£ŸæŒ‡å’Œä¸­æŒ‡äº¤å‰ï¼Œå…¶ä»–æ‰‹æŒ‡å¼¯æ›²ã€‚',
                'S': 'æ¡ç´§æ‹³å¤´ï¼Œæ‹‡æŒ‡æ”¾åœ¨é£ŸæŒ‡å’Œä¸­æŒ‡ä¹‹é—´ã€‚',
                'T': 'å°†æ‹‡æŒ‡æ”¾åœ¨é£ŸæŒ‡ä¸Šæ–¹ï¼Œå½¢æˆä¸€ä¸ªTå½¢çŠ¶ã€‚',
                'U': 'å°†æ‹‡æŒ‡å’Œé£ŸæŒ‡ä¼¸ç›´å¹¶åˆ†å¼€ï¼Œå½¢æˆUå½¢çŠ¶ã€‚',
                'V': 'å°†é£ŸæŒ‡å’Œä¸­æŒ‡ä¼¸ç›´å¹¶åˆ†å¼€ï¼Œå½¢æˆVå½¢çŠ¶ã€‚',
                'W': 'å°†é£ŸæŒ‡ã€ä¸­æŒ‡å’Œæ— åæŒ‡ä¼¸ç›´å¹¶åˆ†å¼€ï¼Œå½¢æˆWå½¢çŠ¶ã€‚',
                'X': 'å°†é£ŸæŒ‡äº¤å‰åœ¨ä¸­æŒ‡ä¸Šï¼Œå½¢æˆXå½¢çŠ¶ã€‚',
                'Y': 'å°†æ‹‡æŒ‡å’Œå°æŒ‡ä¼¸ç›´å¹¶åˆ†å¼€ï¼Œå…¶ä»–æ‰‹æŒ‡å¼¯æ›²ã€‚',
                'Z': 'å…ˆåšIçš„æ‰‹åŠ¿ï¼Œç„¶ååœ¨ç©ºä¸­ç”»ä¸€ä¸ªZå½¢çŠ¶ã€‚'
            };

            guideDescription.textContent = descriptions[gesture] || `æ‰‹åŠ¿ ${gesture} çš„è¯¦ç»†æè¿°ã€‚`;
            guide.classList.remove('hidden');
        }
        
        // æ¸…é™¤å†å²è®°å½•
        async function clearHistory() {
            try {
                const response = await fetch('/api/clear_history', {
                    method: 'POST'
                });
                
                if (!response.ok) {
                    throw new Error('æ¸…é™¤å†å²è®°å½•å¤±è´¥');
                }
                
                await response.json();
                predictionHistory = [];
                updateHistoryTable();
            } catch (error) {
                console.error('æ¸…é™¤å†å²è®°å½•å¤±è´¥:', error);
            }
        }
        
        // ç®€åŒ–ç‰ˆæ»šåŠ¨å‡½æ•°
        function smoothScroll(targetId) {
            console.log('smoothScroll å‡½æ•°è¢«è°ƒç”¨ï¼Œç›®æ ‡ID:', targetId);
            
            // é¦–é¡µé“¾æ¥å¤„ç†
            if (targetId === '') {
                console.log('é¦–é¡µé“¾æ¥ï¼Œæ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨');
                window.scrollTo({ top: 0, behavior: 'smooth' });
                return;
            }
            
            // æŸ¥æ‰¾ç›®æ ‡å…ƒç´ 
            const targetElement = document.getElementById(targetId);
            if (targetElement) {
                console.log('æ‰¾åˆ°ç›®æ ‡å…ƒç´ :', targetId);
                
                // å¦‚æœæ˜¯aboutå…ƒç´ ä¸”è¢«éšè—ï¼Œå…ˆæ˜¾ç¤ºå®ƒ
                if (targetId === 'about' && targetElement.classList.contains('hidden')) {
                    console.log('æ˜¾ç¤ºaboutå…ƒç´ ');
                    targetElement.classList.remove('hidden');
                }
                
                // è®¡ç®—æ»šåŠ¨ä½ç½®
                const targetPosition = targetElement.offsetTop - 80; // å‡å»å¯¼èˆªæ é«˜åº¦
                
                // ä½¿ç”¨åŸç”Ÿçš„å¹³æ»‘æ»šåŠ¨
                window.scrollTo({ 
                    top: targetPosition, 
                    behavior: 'smooth' 
                });
            } else {
                console.warn(`æœªæ‰¾åˆ°ç›®æ ‡å…ƒç´ : #${targetId}`);
                // ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆï¼Œä½¿ç”¨ä¼ ç»Ÿçš„é”šç‚¹è·³è½¬
                window.location.href = '#' + targetId;
            }
        }
        
        // æ·»åŠ å¯¼èˆªé“¾æ¥çš„ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
        function setupNavigation() {
            console.log('setupNavigation å‡½æ•°è¢«è°ƒç”¨');
            // è·å–æ‰€æœ‰å¯¼èˆªé“¾æ¥ï¼ŒåŒ…æ‹¬é¡µè„šä¸­çš„é“¾æ¥
            const navLinks = document.querySelectorAll('nav a, footer a[href^="#"]');
            console.log('æ‰¾åˆ°çš„å¯¼èˆªé“¾æ¥æ•°é‡:', navLinks.length);
            
            // ä¸ºæ¯ä¸ªé“¾æ¥è®¾ç½®äº‹ä»¶å¤„ç†
            navLinks.forEach((link) => {
                console.log('å¤„ç†å¯¼èˆªé“¾æ¥:', link.textContent, link.getAttribute('href'));
                
                // è®¾ç½®é“¾æ¥æ ·å¼
                link.style.cursor = 'pointer';
                
                // ç§»é™¤æ‰€æœ‰å¯èƒ½çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                link.onclick = function(e) {
                    // é˜»æ­¢é»˜è®¤è¡Œä¸º
                    e.preventDefault();
                    
                    console.log('å¯¼èˆªé“¾æ¥è¢«ç‚¹å‡»:', link.textContent, link.getAttribute('href'));
                    
                    // è·å–ç›®æ ‡ID
                    const href = this.getAttribute('href');
                    const targetId = href.substring(1); // ç§»é™¤ # ç¬¦å·
                    console.log('æ»šåŠ¨ç›®æ ‡ID:', targetId);
                    
                    // ç›´æ¥æ»šåŠ¨åˆ°ç›®æ ‡ä½ç½®
                    smoothScroll(targetId);
                    
                    // é˜»æ­¢äº‹ä»¶å†’æ³¡
                    return false;
                };
            });
        }
        
        // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
        document.addEventListener('DOMContentLoaded', function() {
            // è®¾ç½®å¯¼èˆªåŠŸèƒ½
            setupNavigation();
            // æ¨¡å¼åˆ‡æ¢æŒ‰é’®
            document.getElementById('mode-recognition').addEventListener('click', function() {
                sendSettingsUpdate({ mode: 'recognition' });
            });
            
            document.getElementById('mode-learning').addEventListener('click', function() {
                sendSettingsUpdate({ mode: 'learning' });
            });
            
            document.getElementById('mode-demo').addEventListener('click', function() {
                sendSettingsUpdate({ mode: 'demo' });
            });
            
            // å­¦ä¹ æ¨¡å¼åŒºåŸŸçš„æ¨¡å¼åˆ‡æ¢æŒ‰é’®
            if (document.getElementById('learn-mode-buttons')) {
                document.getElementById('learn-mode-buttons').querySelector('#btn-identify-mode').addEventListener('click', function() {
                    sendSettingsUpdate({ mode: 'recognition' });
                });
                
                document.getElementById('learn-mode-buttons').querySelector('#btn-learn-mode').addEventListener('click', function() {
                    sendSettingsUpdate({ mode: 'learning' });
                });
                
                document.getElementById('learn-mode-buttons').querySelector('#btn-demo-mode').addEventListener('click', function() {
                    sendSettingsUpdate({ mode: 'demo' });
                });
            }
            
            // æ¼”ç¤ºæ¨¡å¼åŒºåŸŸçš„æ¨¡å¼åˆ‡æ¢æŒ‰é’®
            if (document.getElementById('demo-mode-buttons')) {
                document.getElementById('demo-mode-buttons').querySelector('#demo-btn-identify-mode').addEventListener('click', function() {
                    sendSettingsUpdate({ mode: 'recognition' });
                });
                
                document.getElementById('demo-mode-buttons').querySelector('#demo-btn-learn-mode').addEventListener('click', function() {
                    sendSettingsUpdate({ mode: 'learning' });
                });
                
                document.getElementById('demo-mode-buttons').querySelector('#demo-btn-demo-mode').addEventListener('click', function() {
                    sendSettingsUpdate({ mode: 'demo' });
                });
            }
            
            // å…³é”®ç‚¹æ˜¾ç¤ºåˆ‡æ¢
            document.getElementById('toggle-landmarks').addEventListener('click', function() {
                showLandmarks = !showLandmarks;
                sendSettingsUpdate({ show_landmarks: showLandmarks });
                
                // æ›´æ–°æŒ‰é’®å›¾æ ‡
                const icon = this.querySelector('i');
                if (showLandmarks) {
                    icon.classList.remove('fa-circle-o');
                    icon.classList.add('fa-dot-circle-o');
                } else {
                    icon.classList.remove('fa-dot-circle-o');
                    icon.classList.add('fa-circle-o');
                }
            });
            
            // åˆ·æ–°æ‘„åƒå¤´
            document.getElementById('refresh-camera').addEventListener('click', function() {
                const videoFrame = document.getElementById('video-frame');
                videoFrame.src = '/video_feed?' + new Date().getTime();
            });
            
            // ç½®ä¿¡åº¦æ»‘å—
            const thresholdSlider = document.getElementById('confidence-slider');
            const thresholdValue = document.getElementById('threshold-value');
            
            thresholdSlider.addEventListener('input', function() {
                confidenceThreshold = parseFloat(this.value);
                thresholdValue.textContent = `${Math.round(confidenceThreshold * 100)}%`;
            });
            
            thresholdSlider.addEventListener('change', function() {
                sendSettingsUpdate({ confidence_threshold: confidenceThreshold });
            });
            
            // å¹³æ»‘çª—å£æ»‘å—
            const smoothSlider = document.getElementById('smooth-slider');
            const smoothValue = document.getElementById('smooth-window-value');
            
            smoothSlider.addEventListener('input', function() {
                smoothWindow = parseInt(this.value);
                smoothValue.textContent = smoothWindow;
            });
            
            smoothSlider.addEventListener('change', function() {
                sendSettingsUpdate({ smooth_window: smoothWindow });
            });
            
            // è®°å½•å¼€å…³
            const recordCheckbox = document.getElementById('is-recording');
            recordCheckbox.addEventListener('change', function() {
                isRecording = this.checked;
                sendSettingsUpdate({ is_recording: isRecording });
            });
            
            // æ¸…é™¤å†å²è®°å½•æŒ‰é’®
            document.getElementById('clear-history').addEventListener('click', clearHistory);
            
            // é‡ç½®ç»Ÿè®¡æŒ‰é’®
            document.getElementById('reset-statistics').addEventListener('click', resetStatistics);
            
            // å¯¼å‡ºæ•°æ®æŒ‰é’®
            document.getElementById('export-data').addEventListener('click', exportData);
            
            // æ‰‹åŠ¿å¡ç‰‡ç‚¹å‡»
            document.querySelectorAll('.gesture-card').forEach(card => {
                card.addEventListener('click', function() {
                    const gesture = this.querySelector('span:first-child').textContent;
                    sendSettingsUpdate({
                        mode: 'learning',
                        current_gesture: gesture
                    });
                    
                    // æ˜¾ç¤ºæ‰‹åŠ¿æŒ‡å—
                    showGestureGuide(gesture);
                    
                    // é«˜äº®é€‰ä¸­çš„å¡ç‰‡
                    document.querySelectorAll('.gesture-card').forEach(c => {
                        c.classList.remove('border-primary', 'bg-primary/5');
                    });
                    this.classList.add('border-primary', 'bg-primary/5');
                });
            });
            
            // æ‰‹åŠ¿æœç´¢
            document.getElementById('gesture-search').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                document.querySelectorAll('.gesture-card').forEach(card => {
                    const gestureText = card.querySelector('span:first-child').textContent.toLowerCase();
                    if (gestureText.includes(searchTerm)) {
                        card.style.display = 'flex';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
            
            // æ‰‹åŠ¿åˆ†ç±»ç­›é€‰
            document.getElementById('gesture-category').addEventListener('change', function() {
                const category = this.value;
                document.querySelectorAll('.gesture-card').forEach(card => {
                    const gesture = card.querySelector('span:first-child').textContent;
                    const isLetter = /^[A-Za-z]$/.test(gesture);
                    const isNumber = /^\d$/.test(gesture);
                    
                    if (category === 'all' || 
                        (category === 'letters' && isLetter) || 
                        (category === 'numbers' && isNumber)) {
                        card.style.display = 'flex';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
            
            // ä¸»é¢˜åˆ‡æ¢
            document.getElementById('theme-toggle').addEventListener('click', function() {
                const icon = this.querySelector('i');
                if (icon.classList.contains('fa-moon-o')) {
                    icon.classList.remove('fa-moon-o');
                    icon.classList.add('fa-sun-o');
                    // è¿™é‡Œå¯ä»¥æ·»åŠ æš—è‰²ä¸»é¢˜åˆ‡æ¢é€»è¾‘
                } else {
                    icon.classList.remove('fa-sun-o');
                    icon.classList.add('fa-moon-o');
                    // æ¢å¤äº®è‰²ä¸»é¢˜
                }
            });
            
            // å¯åŠ¨æŒ‰é’®äº‹ä»¶å¤„ç†
            const startButton = document.getElementById('start-recognition');
            const videoFrame = document.getElementById('video-frame');
            const videoPlaceholder = document.getElementById('video-placeholder');
            const videoControls = document.getElementById('video-controls');
            
            startButton.addEventListener('click', function() {
                isRunning = !isRunning;
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€å’Œæ–‡æœ¬
                const icon = this.querySelector('i');
                const textSpan = this.querySelector('span');
                
                if (isRunning) {
                    // å¯åŠ¨è¯†åˆ«
                    icon.className = 'fa fa-stop-circle text-xl mr-2';
                    textSpan.textContent = 'åœæ­¢è¯†åˆ«';
                    this.classList.remove('bg-secondary', 'hover:bg-secondary/90', 'shadow-secondary/20');
                    this.classList.add('bg-red-500', 'hover:bg-red-600', 'shadow-lg', 'shadow-red-200');
                    
                    // ç›´æ¥è°ƒç”¨toggle_recognitionè·¯ç”±å‘é€å¯åŠ¨å‘½ä»¤åˆ°åç«¯
                    fetch('/toggle_recognition', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ is_running: true })
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log('å¯åŠ¨è¯†åˆ«å“åº”:', data);
                    })
                    .catch(error => {
                        console.error('å¯åŠ¨è¯†åˆ«å¤±è´¥:', error);
                        showNotification('å¯åŠ¨è¯†åˆ«å¤±è´¥', 'error');
                        // æ¢å¤æŒ‰é’®çŠ¶æ€
                        isRunning = false;
                        icon.className = 'fa fa-play-circle text-xl mr-2';
                        textSpan.textContent = 'å¯åŠ¨è¯†åˆ«';
                        this.classList.remove('bg-red-500', 'hover:bg-red-600', 'shadow-red-200');
                        this.classList.add('bg-secondary', 'hover:bg-secondary/90', 'shadow-secondary/20');
                    });
                    
                    // æ˜¾ç¤ºè§†é¢‘æµï¼Œéšè—å ä½ç¬¦
                    videoFrame.src = '/video_feed';
                    videoFrame.classList.remove('hidden');
                    videoPlaceholder.classList.add('hidden');
                    videoControls.classList.remove('hidden');
                    
                    // æ˜¾ç¤ºé€šçŸ¥
                    showNotification('è¯†åˆ«å·²å¯åŠ¨', 'success');
                } else {
                    // åœæ­¢è¯†åˆ«
                    icon.className = 'fa fa-play-circle text-xl mr-2';
                    textSpan.textContent = 'å¯åŠ¨è¯†åˆ«';
                    this.classList.remove('bg-red-500', 'hover:bg-red-600', 'shadow-red-200');
                    this.classList.add('bg-secondary', 'hover:bg-secondary/90', 'shadow-secondary/20');
                    
                    // ç›´æ¥è°ƒç”¨toggle_recognitionè·¯ç”±å‘é€åœæ­¢å‘½ä»¤åˆ°åç«¯
                    fetch('/toggle_recognition', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ is_running: false })
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log('åœæ­¢è¯†åˆ«å“åº”:', data);
                    })
                    .catch(error => {
                        console.error('åœæ­¢è¯†åˆ«å¤±è´¥:', error);
                    });
                    
                    // éšè—è§†é¢‘æµï¼Œæ˜¾ç¤ºå ä½ç¬¦
                    videoFrame.src = '';
                    videoFrame.classList.add('hidden');
                    videoPlaceholder.classList.remove('hidden');
                    videoControls.classList.add('hidden');
                    
                    // æ˜¾ç¤ºé€šçŸ¥
                    showNotification('è¯†åˆ«å·²åœæ­¢', 'info');
                }
            });
            
            // æ˜¾ç¤ºé€šçŸ¥æ¶ˆæ¯çš„å‡½æ•°
            function showNotification(message, type = 'info') {
                // åˆ›å»ºé€šçŸ¥å…ƒç´ 
                const notification = document.createElement('div');
                notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-500 translate-x-full`;
                
                // è®¾ç½®é€šçŸ¥æ ·å¼
                let bgColor, textColor, iconClass;
                switch(type) {
                    case 'success':
                        bgColor = 'bg-green-500';
                        textColor = 'text-white';
                        iconClass = 'fa-check-circle';
                        break;
                    case 'error':
                        bgColor = 'bg-red-500';
                        textColor = 'text-white';
                        iconClass = 'fa-exclamation-circle';
                        break;
                    case 'warning':
                        bgColor = 'bg-yellow-500';
                        textColor = 'text-white';
                        iconClass = 'fa-warning';
                        break;
                    default:
                        bgColor = 'bg-primary';
                        textColor = 'text-white';
                        iconClass = 'fa-info-circle';
                }
                
                notification.classList.add(...bgColor.split(' '), ...textColor.split(' '));
                
                // è®¾ç½®é€šçŸ¥å†…å®¹
                notification.innerHTML = `
                    <div class="flex items-center">
                        <i class="fa ${iconClass} mr-2"></i>
                        <span>${message}</span>
                    </div>
                `;
                
                // æ·»åŠ åˆ°é¡µé¢
                document.body.appendChild(notification);
                
                // æ˜¾ç¤ºé€šçŸ¥
                setTimeout(() => {
                    notification.classList.remove('translate-x-full');
                }, 10);
                
                // è‡ªåŠ¨å…³é—­
                setTimeout(() => {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 500);
                }, 3000);
            }
            
            // è®¾ç½®åˆå§‹é˜ˆå€¼æ˜¾ç¤º
            thresholdValue.textContent = `${Math.round(confidenceThreshold * 100)}%`;
            document.getElementById('smooth-window-value').textContent = smoothWindow;
            
            // åˆå§‹åŒ–å›¾è¡¨
            initGestureChart();
            
            // åˆå§‹åŒ–UIçŠ¶æ€
            const learnSection = document.getElementById('learn');
            if (learnSection) learnSection.classList.add('hidden');
            
            // è°ƒç”¨updateModeButtonsè®¾ç½®åˆå§‹UIæ˜¾ç¤ºçŠ¶æ€
            updateModeButtons();
            
            // å®šæœŸæ›´æ–°çŠ¶æ€
            setInterval(updateSystemState, 150);
        });
    </script>
</body>
</html>